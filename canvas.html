<html>
 <head>
  <script type="application/javascript">
	function move(pos){
		return scale((parseFloat(pos)+50.5));
	}
	function scale(pos){
		return pos*8;
	}
	function loadXMLDoc(dname){
		if (window.XMLHttpRequest){
		  xhttp=new XMLHttpRequest();
		}else{
		  xhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		xhttp.open("GET",dname,false);
		xhttp.send();
		return xhttp.responseXML;
	} 
 function draw() {
xmlDoc=loadXMLDoc("systems_xml.php");
var canvas = document.getElementById("canvas");
var output = document.getElementById("output");
var ctx = canvas.getContext("2d");
 
 ctx.fillStyle = "rgb(0,0,0)";
 ctx.fillRect (0, 0, 808, 808);
w=xmlDoc.getElementsByTagName("Wormhole");
 for (i = 0; i < w.length; i++){
	wormhole = w[i].attributes;
	ctx.lineWidth = 2;
	ctx.beginPath();
	ctx.moveTo(move(wormhole.getNamedItem("x1").nodeValue),move(wormhole.getNamedItem("y1").nodeValue));
	ctx.lineTo(move(wormhole.getNamedItem("x2").nodeValue),move(wormhole.getNamedItem("y2").nodeValue));
	ctx.strokeStyle = "#0000FF";
	ctx.closePath();
	ctx.stroke();
}

f=xmlDoc.getElementsByTagName("Fleet");
 ctx.fillStyle = "#FF00FF";
 for (i = 0; i < f.length; i++){
	fleet = f[i].attributes;
	ctx.lineWidth = 2;
	ctx.strokeStyle = "#590059";
	ctx.beginPath();
	ctx.moveTo(move(fleet.getNamedItem("x1").nodeValue),move(fleet.getNamedItem("y1").nodeValue));
	ctx.lineTo(move(fleet.getNamedItem("cx").nodeValue),move(fleet.getNamedItem("cy").nodeValue));
	ctx.stroke();
	ctx.closePath();
	ctx.strokeStyle = "#FF00FF";
	ctx.beginPath();
	ctx.moveTo(move(fleet.getNamedItem("cx").nodeValue),move(fleet.getNamedItem("cy").nodeValue));
	ctx.lineTo(move(fleet.getNamedItem("x2").nodeValue),move(fleet.getNamedItem("y2").nodeValue));
	ctx.stroke();
	ctx.closePath();
	ctx.beginPath();
    ctx.arc(move(fleet.getNamedItem("cx").nodeValue),move(fleet.getNamedItem("cy").nodeValue),2,0,Math.PI*2,true);
    ctx.fill();
    ctx.stroke();
}
ctx.fillStyle = "#000000";
s=xmlDoc.getElementsByTagName("System");

for (i = 0; i < s.length; i++){
	var image;
	system = s[i].attributes;
	image = (system.getNamedItem("id").nodeValue%4)+1;
	//output.innerHTML = output.innerHTML + system.getNamedItem("id").nodeValue + "=" + system.getNamedItem("x").nodeValue + "," + system.getNamedItem("y").nodeValue + "(" + image + ") <br/>";
	var star = document.getElementById("star"+image);
	ctx.drawImage(star, move(system.getNamedItem("x").nodeValue)-4, move(system.getNamedItem("y").nodeValue)-4,8,8);
}
 
c=xmlDoc.getElementsByTagName("Colony");

for (i = 0; i < c.length; i++){
	var image;
	colony = c[i].attributes;
    if(colony.getNamedItem("own").nodeValue > 0) ctx.strokeStyle = "#00FF00";
    if(colony.getNamedItem("others").nodeValue > 0) ctx.strokeStyle = "#FF0000";
    if(colony.getNamedItem("own").nodeValue > 0 && colony.getNamedItem("others").nodeValue > 0) ctx.strokeStyle = "#FFFF00";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(move(colony.getNamedItem("x").nodeValue),move(colony.getNamedItem("y").nodeValue),4,0,Math.PI*2,true);
    ctx.closePath();
    ctx.stroke();
}

}
  </script>
 </head>
 <body onload="draw()">
	<img src="http://vps.dynamicarcade.co.uk/SpaceMMO/images/star1.png" id="star1" style="display:none;"/>
	<img src="http://vps.dynamicarcade.co.uk/SpaceMMO/images/star2.png" id="star2" style="display:none;"/>
	<img src="http://vps.dynamicarcade.co.uk/SpaceMMO/images/star3.png" id="star3" style="display:none;"/>
	<img src="http://vps.dynamicarcade.co.uk/SpaceMMO/images/star4.png" id="star4" style="display:none;"/>
	<div id="output"></div>
   <canvas id="canvas" width="808" height="808"></canvas>
 </body>
</html>
