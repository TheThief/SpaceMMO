<?phpinclude 'includes/start.inc.php';$page = (isset($_POST["p"]))?$_POST["p"]:"";$qs = (isset($_POST["q"]))?$_POST["q"]:"";$query = $mysqli->prepare('SELECT userID,lastlogin from users WHERE username=? AND passhash=UNHEX(?)');if (!$query){	echo 'error: ', $mysqli->error, $eol;	exit;}$query->bind_param('ss', $username, $passhash);$username = $_POST['username'];$passhash = sha1($_POST['password']);$result = $query->execute();if (!$result){	echo 'error: ', $query->error, $eol;	exit;}$query->bind_result($userid, $lastlogin);$query->fetch();if (!$userid){	echo 'login failed', $eol;		header('HTTP/1.1 303 See Other');	header('Location: login_form.php?error=1');	exit;}$query->close();$query = $mysqli->prepare('UPDATE users SET phpsessionid=UNHEX(?), lastlogin=NOW() WHERE userID=?');if (!$query){	echo 'error: ', $mysqli->error, $eol;	exit;}session_regenerate_id();$_SESSION['userid']=$userid;$query->bind_param('si', $sessionid, $userid);$sessionid = session_id();$result = $query->execute();if (!$result){	echo 'error: ', $query->error, $eol;	exit;}$redir ="list_colonies.php";if($page != ""){	$redir=$page;	if($qs != "") $redir.= "?" . urldecode($qs);}header('HTTP/1.1 303 See Other');header('Location: '.$redir);echo 'Successfully logged in!', $eol;echo 'Last login: ', $lastlogin, $eol;echo '<a href="',$redir,'">Continue...</a>', $eol;?>